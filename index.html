<html>
	<head>
		<title>What is, where what, what am I even?</title>
		<link rel="stylesheet" type="text/css" href="default_style.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
	</head>
	
	<body>
		<div id="mapView">
			<div id="mapWrapper">
				<div id="map">
					
				</div>
				<div id="info">
					<button id="startMap" onclick="initGame()">Start Game</button>
					<br/>
					<span id="status">You have not played yet.</span>
				</div>
			</div> <!-- mapWrapper -->
		</div> <!-- mapView -->
		
		<div id="gameView" style="display: none;">
			FC: <span id="framecounter">0</span>
			HP :  <span id="hp">0</span>
			Theta: <span id="theta">0</span>
			X: <span id="posX">0</span>
			Y: <span id="posY">0</span>
			<br/>
			<canvas id="screen" width="1000" height="800"></canvas>
		</div> <!-- gameView-->
	</body>
	
	<script src="input.js" type="text/javascript"></script>
	<script src="gfx.js" type="text/javascript"></script>
	<script src="mobs.js" type="text/javascript"></script>
	<script src="movement.js" type="text/javascript"></script>
	
	<script type="text/javascript">
		// Display and meta globals
		var can = document.getElementById("screen");
		var ctx = can.getContext("2d");
		var keepPlaying = true;
		var mainLoop = false;
		var completed = false;
		var fc = 0;
		
		// Player, enemies and environment
		var mobs = [];
		var hp = 100;
		
		// Input and movement
		var keyStatus = {};
		var speed = 10;
		var zspeed = 15;
		var startX = 500;
		var startY = 400;
		var colRad = 420;
		var posX = 0;
		var posY = 0;
		var posZ = 0;
		var theta = 0;
		var r = 0;
		
		// Other
		var PI = Math.PI
		var PI2 = PI / 2;
		var PI32 = 3 * PI / 2;
		
		// Stuff that only needs to be done once
		registerListeners();
		
		function initGame(event) {
			var gameView = document.getElementById("gameView").style.display = "block";
			var mapView = document.getElementById("mapView").style.display = "none";
			
			completed = false;
			keepPlaying = true;
			hp = 100;
			fc = 0;
			resetMobs();
			resetMovement();
			
			mainLoop = window.setInterval("upkeep()", 30);
		}
		
		function initMap(event) {
			var gameView = document.getElementById("gameView").style.display = "none";
			var mapView = document.getElementById("mapView").style.display = "block";
			document.getElementById("status").innerHTML = "You have " + (completed ? "won" : "lost") + " the last round.";
		}
		
		function upkeep() {
			fc++;
			ctx.clearRect(0, 0, can.width, can.height);
			
			doMovement();
			drawTunnel();
			drawMobs();
			drawPlayerAt(posX + startX, posY + startY);
			drawGUI();
			
			if (hp <= 0) {
				keepPlaying = false;
				completed = false;
			}
			if (fc > 2000) {
				keepPlaying = false;
				completed = true;
			}
			
			if (!keepPlaying) {
				window.clearInterval(mainLoop);
				initMap();
			}
		}
	</script>
</html>