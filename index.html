<html>
	<head>
		<title>What is, where what, what am I even?</title>
		<link rel="stylesheet" type="text/css" href="default_style.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js" type="text/javascript"></script>
	</head>
	<body>
		<canvas id="screen" width="1000" height="700" style="border: 1px solid #222222">
		
		</canvas>
	</body>
	<script type="text/javascript">
		var can = document.getElementById("screen");
		var ctx = can.getContext("2d");
		var keepPlaying = true;
		var keyStatus = {};
		var speed = 4;
		var startX = 400;
		var startY = 300;
		var posX = startX;
		var posY = startY;
		var poxZ = 0;
		var PI = Math.PI
		var PI2 = PI / 2;
		var PI32 = 3 * PI / 2;
		
		var mainLoop = window.setInterval("upkeep()", 30);
		
		window.addEventListener("keydown", function(event) {
			switch (event.keyCode) {
				case 87: // w
					keyStatus[0] = true;
					break;
				
				case 65: // a
					keyStatus[1] = true;
					break;
					
				case 83: // s
					keyStatus[2] = true;
					break;
					
				case 68: // d
					keyStatus[3] = true;
					break;
			}
		}, false);
		
		window.addEventListener("keyup", function(event) {
			switch (event.keyCode) {
				case 87: // w
					keyStatus[0] = false;
					break;
				
				case 65: // a
					keyStatus[1] = false;
					break;
					
				case 83: // s
					keyStatus[2] = false;
					break;
					
				case 68: // d
					keyStatus[3] = false;
					break;
			}
		}, false);
		
		function upkeep() {
			ctx.clearRect(0, 0, can.width, can.height);
			doMovement();
			drawPlayerAt(posX, posY);
		}
		
		function doMovement() {
			// This would be much easier with polar coordinates, but webdev has made go uuuuuhhhh at math
			var r = Math.sqrt((startX-posX)*(startX-posX) + (startY-posY)*(startY-posY));
			var distX = startX - posX;
			var distY = startY - posY;
			var dx = 0;
			var dy = 0;
			var phi = 0;
			
			if (r < 300) {
				dx -= keyStatus[1] ? speed : 0;
				dx += keyStatus[3] ? speed : 0;
				dy -= keyStatus[0] ? speed : 0;
				dy += keyStatus[2] ? speed : 0;
			} else {
				r = 300;
				theta = Math.atan2(distY, distX);
				if (theta <= PI2) { // Upper right quadrant
					theta += keyStatus[0] ? 0.1 : 0;
					theta += keyStatus[1] ? 0.2 : 0;
					theta -= keyStatus[2] ? 0.2 : 0;
					theta -= keyStatus[3] ? 0.1 : 0;
				} else if(theta <= PI) { // Upper left quadrant
					theta -= keyStatus[0] ? 0.1 : 0;
					theta += keyStatus[1] ? 0.1 : 0;
					theta += keyStatus[2] ? 0.2 : 0;
					theta -= keyStatus[3] ? 0.2 : 0;
				} else if(theta <= PI32) { // Lower left quadrant
					theta -= keyStatus[0] ? 0.2 : 0;
					theta -= keyStatus[1] ? 0.1 : 0;
					theta += keyStatus[2] ? 0.1 : 0;
					theta += keyStatus[3] ? 0.2 : 0;
				} else { // Lower right quadrant
					theta += keyStatus[0] ? 0.2 : 0;
					theta -= keyStatus[1] ? 0.2 : 0;
					theta -= keyStatus[2] ? 0.1 : 0;
					theta += keyStatus[3] ? 0.1 : 0;
				}
				posX = Math.cos(theta) * r;
				posY = Math.sin(theta) * r;
				dx = dy = 0;
				// x=cos(theta)*r y=sin(theta)*r, theta=atan2(y,x) r=math.sqrt(x*x+y*y);
			}
			
			if (dx != 0 && dy != 0) {
				dy *= 0.7071067811;
				dx *= 0.7071067811;
			}
			
			posX += dx;
			posY += dy;
		}
		
		function drawPlayerAt(x, y) {
			ctx.fillStyle = "#222244";
			ctx.fillRect(x, y, 70, 70);
		}
	</script>
</html>